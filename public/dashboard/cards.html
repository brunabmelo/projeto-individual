<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Eevee | Cuidados</title>


    <link rel="stylesheet" href="./../css/dashboards.css">
    <script src="../js/sessao.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com">
</head>

<body onload="validarSessao(),  atualizacaoPeriodica()">

<!--MENU SITE-->
<div class="janela">

    <div class="header-left dash-header">
        <!--icone clicavel -->
        <a href="./cards.html">
            <img src="../assets/logo/iconLogo-1.png" class="logo">
        </a>

        <div class="hello">
            <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
        </div>

        <div class="btn-nav">
            <h3>Meu Eevee</h3>
        </div>

        <div class="btn-nav-white">
            <a href="./dashboareevee.html">
                <h3>Gráficos</h3>
            </a>
        </div>


        <div class="btn-logout" onclick="limparSessao()">
            <h3>Sair</h3>
        </div>

    </div>
    <!--FINAL MENU -->

    <!--BARRA XP -->
    <div class="dash">
        <div class="barra-de-progresso">
            <p class="titulo-legenda">
                XP - Progresso de felicidade para evoluir seu Eevee
            </p>

            <div id="barraxp" class="outer">
                <div id="progress" class="inner" style="width: 0px;"></div>

            </div>
        </div>
        <div class="kpi-box">
            <div class="kpi-text">
                <span id="kpi">0</span>%
            </div>
        </div>

        <div id="pet">
            <img src="../assets/pet/Eevee-normal.png">
        </div>

        <div class="interacao">
            <button class="botao" onclick="Comida()" id="botaos" value="comida">Comida</button>
            <button class="botao" onclick="Agua()" id="botaos" value="água">Água</button>
            <button class="botao" onclick="Carinho()" id="botaos" value="carinho">Carinho</button>
        </div>

    </div>


    </body>

    <script>
        b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

        var barracor = document.getElementById("barraxp");
        var progresscontagem = document.getElementById("progress");
        var nivel = progresscontagem.clientWidth;
        var comida = 0;
        var agua = 0;
        var carinho = 0;
        var acao = "";
        var porcetagem;

        // AÇÃO COMIDA
        function Comida() {
            if (progresscontagem.clientWidth >= barracor.clientWidth) {
                evolucao();
            } else {
                acao = "Comida"

                pet.innerHTML = `<img src="../assets/pet/Eevee-feliz.png">`
                setTimeout(function () { pet.innerHTML = `<img src="../assets/pet/Eevee-normal.png">` }, 500);

                progresscontagem.style.width = progresscontagem.offsetWidth + 50 + "px";
                comida++;

                porcetagem = ((comida + agua + carinho) / 13) * 100;

                function atualizar() {
                    nivel = progresscontagem.clientWidth;
                    kpi.innerHTML = porcetagem.toFixed(0);
                }
                atualizar()
                cadastrar()
            }

        }


        // AÇÃO ÁGUA    
        function Agua() {
            if (progresscontagem.clientWidth >= barracor.clientWidth) {
                evolucao();
            } else {
                acao = "Água"
                pet.innerHTML = `<img src="../assets/pet/Eevee-feliz.png">`
                setTimeout(function () { pet.innerHTML = `<img src="../assets/pet/Eevee-normal.png">` }, 500);

                progresscontagem.style.width = progresscontagem.offsetWidth + 50 + "px";
                agua++;

                porcetagem = ((comida + agua + carinho) / 13) * 100;

                function atualizar() {
                    nivel = progresscontagem.clientWidth;
                    kpi.innerHTML = porcetagem.toFixed(0);

                }
                atualizar()
                cadastrar()
            }
        }

        // AÇÃO CARINHO
        function Carinho() {
            if (progresscontagem.clientWidth >= barracor.clientWidth) {

                evolucao();
            } else {
                acao = "Carinho"

                pet.innerHTML = `<img src="../assets/pet/Eevee-feliz.png">`
                setTimeout(function () { pet.innerHTML = `<img src="../assets/pet/Eevee-normal.png">` }, 500);

                progresscontagem.style.width = progresscontagem.offsetWidth + 50 + "px";
                carinho++;

                porcetagem = ((comida + agua + carinho) / 13) * 100;


                function atualizar() {
                    nivel = progresscontagem.clientWidth;
                    kpi.innerHTML = porcetagem.toFixed(0);

                }
                atualizar()
                cadastrar()
            }

            
        }
        // EVOLUÇÃO
        function evolucao() {

            if (comida > agua && comida > carinho) {
                pet.innerHTML = `<img src="../assets/pet/flareon.png">`
                progresscontagem.style.background = "#E0482A"
            }
            else if (agua > comida && agua > carinho) {
                pet.innerHTML = `<img src="../assets/pet/vaporeon.png">`
                progresscontagem.style.background = "#2E94BC"
            }
            else if (carinho > comida && carinho > agua) {

                pet.innerHTML = `<img src="../assets/pet/jolteon.png">`
                progresscontagem.style.background = "#F9E85C"
            }else{

                pet.innerHTML = `<img src="../assets/pet/umbreon.png">`
                progresscontagem.style.background = "#3F4B50"
            }
        }

        //CADASTRO NO BD EVOLUÇÃO

        function cadastrar() {
            var idusuario = sessionStorage.ID_USUARIO;

            fetch(`/grafico/cadastrar/${idusuario}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idusuario: idusuario,
                    acaoVar: acao,
                    xpVar: nivel
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);
                    console.log(`ENTREI FUNCTION`);

                    if (resposta.ok) {

                        console.log("ok FET")


                    } else {
                        console.log("Erro FET")
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

        }



    </script>

</html>